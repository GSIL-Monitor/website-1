!function(root,factory){"function"==typeof define&&define.amd?define(function(){return factory(root)}):"object"==typeof exports?module.exports=factory:root.echo=factory(root)}(this,function(root){"use strict";var echo={},callback=function(){},offset,poll,delay,useDebounce,unload,container=document,isHidden=function(element){return null===element.offsetParent},inView=function(element,view){return!isHidden(element)&&(container===document?(box=element.getBoundingClientRect()).right>=view.l&&box.bottom>=view.t&&box.left<=view.r&&box.top<=view.b:(box=element.offsetParent===container?element.getBoundingClientRect():(element=getParent(element)).getBoundingClientRect()).right>=view.l&&element.offsetTop+element.offsetHeight-container.scrollTop>=view.t&&box.left<=view.r&&element.offsetTop-container.scrollTop<=container.offsetHeight+offset.b);var box,box},getParent=function(elm){return elm.offsetParent!==container?getParent(elm.offsetParent):elm},debounceOrThrottle=function(){!useDebounce&&poll||(clearTimeout(poll),poll=setTimeout(function(){echo.render(),poll=null},delay))};return echo.init=function(opts){var offsetAll=(opts=opts||{}).offset||0,offsetVertical=opts.offsetVertical||offsetAll,offsetHorizontal=opts.offsetHorizontal||offsetAll,optionToInt=function(opt,fallback){return parseInt(opt||fallback,10)};offset={t:optionToInt(opts.offsetTop,offsetVertical),b:optionToInt(opts.offsetBottom,offsetVertical),l:optionToInt(opts.offsetLeft,offsetHorizontal),r:optionToInt(opts.offsetRight,offsetHorizontal)},delay=optionToInt(opts.throttle,250),useDebounce=!1!==opts.debounce,unload=!!opts.unload,callback=opts.callback||callback,opts.container&&document.querySelector(opts.container)&&(container=document.querySelector(opts.container)),echo.render(),document.addEventListener?container===document?(root.addEventListener("scroll",debounceOrThrottle,!1),root.addEventListener("load",debounceOrThrottle,!1)):(container.addEventListener("scroll",debounceOrThrottle,!1),container.addEventListener("load",debounceOrThrottle,!1)):container===document?(root.attachEvent("onscroll",debounceOrThrottle),root.attachEvent("onload",debounceOrThrottle)):(container.attachEvent("onscroll",debounceOrThrottle),container.attachEvent("onload",debounceOrThrottle))},echo.render=function(context){for(var nodes=(context||document).querySelectorAll("[data-echo], [data-echo-background]"),length=nodes.length,src,elem,view={l:0-offset.l,t:0-offset.t,b:(root.innerHeight||document.documentElement.clientHeight)+offset.b,r:(root.innerWidth||document.documentElement.clientWidth)+offset.r},i=0;i<length;i++)elem=nodes[i],inView(elem,view)?(unload&&elem.setAttribute("data-echo-placeholder",elem.src),null!==elem.getAttribute("data-echo-background")?elem.style.backgroundImage="url("+elem.getAttribute("data-echo-background")+")":elem.src!==(src=elem.getAttribute("data-echo"))&&(elem.src=src),unload||(elem.removeAttribute("data-echo"),elem.removeAttribute("data-echo-background")),callback(elem,"load")):unload&&(src=elem.getAttribute("data-echo-placeholder"))&&(null!==elem.getAttribute("data-echo-background")?elem.style.backgroundImage="url("+src+")":elem.src=src,elem.removeAttribute("data-echo-placeholder"),callback(elem,"unload"));length||echo.detach()},echo.detach=function(){document.removeEventListener?root.removeEventListener("scroll",debounceOrThrottle):root.detachEvent("onscroll",debounceOrThrottle),clearTimeout(poll)},echo});